# Perma Automation

### Project Description
This project was built around the idea that the Perma.cc service is great but the ability to manage users in batch was not possible. Instead of spending the time managing the addition and subtraction of users manually, we chose to spend our time building the scripts to do this in a more automated way.

This project uses Python scripts and implements Selenium actions. You should be able to understand some of the basics of declaring or editing Python dictionaries and you should be at least somewhat comfortable walking through the code (even if you don't understand it all). For reference and improvement, the Selenium documentation is [here](https://www.selenium.dev/documentation/webdriver/).

### File Orientation
There are only a few files that are needed for this project:
- **[perma_organizations_list.csv](/perma_organizations_list.csv)**
	 * This file contains 4 columns and is used in both the add and remove processes.
	 * Column 1 contains the name of the Perma Organization
	 * Column 2 contains the abbreviation (if there is one and you care to add it)
	 * Column 3 contains the Perma Code (see explanation in the "Script Explanations" section below)
	 * Column 4 contains a 'Y' if the Organization is one that you want to apply the `perma_rm_user.py` script to. (In our use case, these are only journals so the column is called 'Jrnl') 
- **[CSV_list_example.csv](/CSV_list_example.csv)**
	 * This file is an example of the file you will receive from the journals containing email addresses for new users to add to the journal's Perma Organization
	 * When using your own CSV file, the default behavior fo the script is expecting a column with the heading of 'email' (without the quotes). If you don't want to use the default behavoir you will need to update the script to match the column heading that contains email addresses
	 * This file will be used in the `perma_add_user.py` script
- **[creds_example.py](/creds_example.py)**  
  * This file should be renamed as `creds.py` and be updated for your own use. It is included in the .gitignore file which will make it work locally with the scripts and also not push your credentials it to any git repository if you are doing that kind of thing. If you are using Git, please make sure you have a .gitignore file and that it contains your `creds.py` file.
  * You should look at the file and replace what is there with your Perma login credentials
- **[.gitignore](/.gitignore)**  
  * This file is important for git users as it is the place where you name the files you don't want to share (see the note below explaining what's in there and why)
  * You may have other files that you don't want to push to a Git repository. You should be sure to add those diles and directories to your own `.gitignore` file
- **[perma_add_user.py](/perma_add_user.py)**  
  * This is the script to be used for adding a new group of users. See the further explanation below.
- **[perma_rm_user.py](/perma_rm_user.py)**  
  * This is the script to be used for removing users. See the further explanation below.
- **[README.md](/README.md)**  
  * You are reading this right now!

**Your .gitignore file:**

This is important because you really only need the necessary items to be shared to git. If you are pushing a copy of this to your own git repository, please pay attention to this file.

- /geckodriver.log (this is generated when you run the scripts as a result of Selenium - there is no need to push this to the repository)
- /creds.py (this should be ignored so you don't publicly post your Perma credentials)
- \_\_pycache\__/ (this is generated when you run the script but has no importance in sharing with git)
- \*.\*~ (you may need to change this but for at least one of us, this was necessary to avoid uploading autosaved versions of files created in emacs)
- .#* (similar to above, this exists to ignore autosaved versions of files)
- .DS_Store (this is here for all of you Mac users)
- /perma_env/ (this is ignored as it is generated by creating the virtual environment using venv and does not need to be shared - note that your environment may be called something different so this may need to be updated)
******
### Running Scripts
Like all work with scripts, there can be many benefits to running your scripts in virtual environments. Common practice is using virtual environments any time we are running third party packages and it is just good practice.

You create a virtual environment by going into your project's directory and run this command:
```
python3 -m venv perma_env
```
This creates a virtual environment called 'perma_env' but you can change this to be called whatever you want.

To activate your virtual environment (in this case called 'perma_env') you would use this command:
```
source perma_env/bin/activate
```


### Script Explanations

#### [perma_rm_user.py](/perma_rm_user.py)
The script is intended to be interacted with from the command line in order to initiate all of the information you need to run the script.

1) You need to have a CSV with information about your Perma Organizations. The script is expecting a file called 'perma_organizations_list.csv' but you can change that in the script if it doesn't suit you. See the section 'File Orientation' above for information about the contents of this file. To get the Perma Codes for your Perma Organizations follow these steps:
* The easiest way to get this number for each organization is to login to your perma account as the registrar
    * go to the Organization Users section (the same as going to https://perma.cc/manage/organization-users)
    * in the 'Filter & Sort' section, choose the organization you'd like to get the number for
    * the resulting link will be ``https://perma.cc/manage/organization-users?org=[the-org-number-to-use-in-journal_dict-for-this-organization]``

2) Running the script will look like this:
```
python3 perma_rm_user.py
```
* This should print out information from your perma_organizations_list.csv file that includes:
    * a list of Abbreviations (Column 2) with the corresponding Perma Code for the Perma Organization (Column 3)
    * NOTE: This list will be filtered to only display items with a `Y` in Column 4
    * Note that every organization on this list will be affected by this process. If you are testing, be sure to have only a limited number of rows with a 'Y' in Column 4 of your organizations file.
* Next you will see a confirmation message prompting you to push `y` if you would like to continue with the removal script.
    * NOTE: Entering anything except a lowercase 'y' will quit the script
* If you entered `y` you wil be prompted to enter the cutoff year for removal which is expecting a 4 digit year
    * The cutoff year is inclusive. That means accounts created during that year and earlier will be removed.
    * NOTE: If you are testing the script, enter a year that is prior to any of your entries. The script should still run but not remove anyone.
* Upon pressing 'Enter' the script should open a Firefox page, log you in and remove member accounts for the corresponding organizations.
    * Reporting includes:
      * The Abbreviation for the organization along with the number of members removed. This also includes a separate note if there are no users in the organization.

To get a sense of what this will look like, see the following screenshot with an early cutoff date that results in no user removal.

![image](https://media.github.berkeley.edu/user/1824/files/67d63b2f-c76b-44fb-9086-069d9bd306a7)


#### [perma_add_user.py](/perma_add_user.py)
This script will require a couple items to run successfully:
1) A CSV that has a column with the column name of 'email'
* This column will contain the email addresses of the new users. Note that the script will only add the user by email to the organization but will not populate the name field for the user.
* See [CSV_list_example.csv](/CSV_list_example.csv) for an example of what your file should look lik
2) The Perma organization number.
* The script is set up to print out the Perma Organization names (Column 1) and the Perma Code (Column 3) from from [perma_organizations_list.csv](/perma_organizations_list.csv)

3) Running the script will look like this:
```
python3 perma_add_user.py
```
* The first thing printed will be the Perma Organization names along with the corresponding Perma Code
    * NOTE: The items here are being read directly from your version of the perma_organizations_list.csv
    * If you would like to add a new Perma Organization, you only need to update the CSV
* You will then be prompted to enter the name of *your* CSV file that contains the email addresses of the people you would like to add to a Perma Organization
    * NOTE: This file must have a column with the heading of 'email' or you will need to update the script to reflect whatever header you are using with your file
    * BONUS NOTE: There is no check on this file existing so be sure to enter the name of your file correctly. This file should be in the same location that you are running the script from.
    * Side Note: You should probably add the name of this file to your .gitignore file if you are upushing to a git repository so you don't push out people's contact information in a place you are not intending to do so  
* You will then be prompted to enter the Organization Code
    * NOTE: This code will be printed above the prompt and if it is not, it is likely not reflected in your CSV

* After entering the Organization Code, the script will open a Firefox browser session and add each of the email addresses to the specified organization.
    







